<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
    
      Python Rinocloud tutorial &middot; Rinocloud
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/styles.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="https://s3-eu-west-1.amazonaws.com/rinocloud/static/Rreverse.png">
  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="Rinocloud" href="/atom.xml">
</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <h3 class="masthead-title">
          <a href="/" title="Home">Rinocloud</a>
          <small>blog</small>
          <small><a style="float:right; margin-top:5px;" href="https://rinocloud.com">go to rinocloud.com</a></small>
        </h3>

      </header>

      <main>
        <article class="post">
  <h1 class="post-title">Python Rinocloud tutorial</h1>
  <time datetime="2016-01-08T17:34:57+00:00" class="post-date">08 Jan 2016</time>
  <div class="post-date">by Fernando</div>
  <h3 id="introduction">Introduction</h3>
<p>Lets get started on RinoCloud’s API using Python and the <a href="http://docs.python-requests.org/en/latest/">requests</a> library.</p>

<p>RinoCloud will store your files in a similar fashion as to the filesystem in your computer. The main units of work are files and folders. Files can have a JSON object to hold metadata related to them.</p>

<p>Lets get started then with our Python code.</p>

<p>After making sure that we have the requests library installed, if not a quick <code class="highlighter-rouge">$ pip install requests</code> should fix it.</p>

<p>To get access we need to add an authentication header to each request. Go to the <a href="https://rinocloud.com/api/1/users/token">token api</a> and get your token (if your signed in to rinocloud).</p>

<h3 id="accessing-rinocloud">Accessing rinocloud</h3>

<p>Get your API access token at <a href="https://rinocloud.com/integrations">https://rinocloud.com/integrations</a> if you are signed into rinocloud.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">    <span class="c"># get your token at https://rinocloud.com/integrations</span>
    <span class="n">token</span> <span class="o">=</span> <span class="s">'&lt;your token&gt;'</span>
    <span class="c"># we make some headers to be sent with each http request.</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'Authorization'</span><span class="p">:</span> <span class="s">'Token </span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">token</span><span class="p">,</span>
        <span class="s">'X-Requested-With'</span><span class="p">:</span> <span class="s">'XMLHttpRequest'</span>
    <span class="p">}</span></code></pre></figure>

<h3 id="creating-folder">Creating Folder</h3>
<p>We can start by creating a folder where we will upload our files:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">    <span class="kn">import</span> <span class="nn">requests</span>

    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s">'name'</span><span class="p">:</span> <span class="s">'my_test_folder'</span><span class="p">}</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">'https://rinocloud.com/api/1/files/create_folder/'</span><span class="p">,</span>
                      <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">r</span><span class="o">.</span><span class="n">status</span>  <span class="c"># should be 201 created</span>

    <span class="n">folder_id</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s">"id"</span><span class="p">]</span>  <span class="c"># we will use this to upload to this folder</span></code></pre></figure>

<h3 id="uploading-file">Uploading File</h3>
<p>After creating our folder, lets upload our first file into it, we use a slightly different way to upload metadata with a file, we place it in a field called json, this is because the HTTP request has a <code class="highlighter-rouge">multipart/form-data</code> content-type.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">    <span class="nb">file</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s">'file'</span><span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="s">'riemman_hypothesis_proof.txt'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s">'parent'</span><span class="p">:</span> <span class="n">folder_id</span><span class="p">,</span>
      <span class="s">'tags'</span><span class="p">:</span> <span class="p">[</span><span class="s">"math"</span><span class="p">,</span> <span class="s">"proof"</span><span class="p">,</span> <span class="s">"riemman"</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">'https://rinocloud.com/api/1/files/upload/'</span><span class="p">,</span>
                      <span class="n">files</span><span class="o">=</span><span class="nb">file</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">'json'</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">metadata</span><span class="p">)},</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">r</span><span class="o">.</span><span class="n">status</span>  <span class="c"># should be 201, created.</span>

    <span class="n">file_id</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s">"id"</span><span class="p">]</span></code></pre></figure>

<h3 id="updating-metadata">Updating Metadata</h3>
<p>Let’s now update some of the metadata of this new file we just uploaded:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s">'id'</span><span class="p">:</span> <span class="n">file_id</span><span class="p">,</span>
  <span class="s">'field1'</span><span class="p">:</span> <span class="s">'Some description text'</span><span class="p">,</span>
  <span class="s">'field2'</span><span class="p">:</span> <span class="p">[</span><span class="mf">100.5</span><span class="p">,</span> <span class="s">'RinoCloud'</span><span class="p">,</span> <span class="n">true</span><span class="p">]</span>
<span class="p">}</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">'https://rinocloud.com/api/1/files/update/'</span><span class="p">,</span>
                  <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="k">print</span> <span class="n">r</span><span class="o">.</span><span class="n">status</span>  <span class="c"># should be 200 ok</span></code></pre></figure>

<h3 id="getting-metadata">Getting Metadata</h3>
<p>Getting this metadata back from a file is quite simple too:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s">'id'</span><span class="p">:</span> <span class="s">'&lt;object-id&gt;'</span><span class="p">}</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">'https://rinocloud.com/api/1/files/get_metadata/'</span><span class="p">,</span>
                  <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="k">print</span> <span class="n">r</span><span class="o">.</span><span class="n">status</span>  <span class="c"># should be 200 ok</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span></code></pre></figure>

<h3 id="getting-childrens-of-object">Getting Childrens of object</h3>
<p>Childrens of a given object can be retrieved with:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s">'id'</span><span class="p">:</span> <span class="s">'&lt;object-id&gt;'</span><span class="p">}</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">'https://rinocloud.com/api/1/files/children/'</span><span class="p">,</span>
                  <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="k">print</span> <span class="n">r</span><span class="o">.</span><span class="n">status</span>  <span class="c"># should be 200 ok</span>
<span class="n">children</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span></code></pre></figure>

<h3 id="getting-ancestors-of-object">Getting Ancestors of Object</h3>
<p>And just as them, Ancestors of an object:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s">'id'</span><span class="p">:</span> <span class="s">'&lt;object-id&gt;'</span><span class="p">}</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s">'https://rinocloud.com/api/1/files/ancestors/'</span><span class="p">,</span>
                  <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="k">print</span> <span class="n">r</span><span class="o">.</span><span class="n">status</span>  <span class="c"># should be 200 ok</span></code></pre></figure>

<h3 id="downloading-file">Downloading File</h3>
<p>If you want to download a file:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'https://rinocloud.com/api/1/files/download/?id=&lt;object-id&gt;'</span><span class="p">,</span>
                 <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="k">print</span> <span class="n">r</span><span class="o">.</span><span class="n">status</span>  <span class="c"># should be 200 ok</span>
<span class="k">print</span> <span class="n">r</span><span class="o">.</span><span class="n">content</span>  <span class="c"># file content</span></code></pre></figure>

<h3 id="downloading-a-large-file">Downloading a large file</h3>

<p>We got this code from a great answer by Roman Podlinov on <a href="http://stackoverflow.com/questions/16694907/how-to-download-large-file-in-python-with-requests-py">Stack overflow</a>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">headers</span><span class="p">):</span>
    <span class="n">local_filename</span> <span class="o">=</span> <span class="n">filename</span>
    <span class="c"># NOTE the stream=True parameter</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_filename</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">chunk</span><span class="p">:</span> <span class="c"># filter out keep-alive new chunks</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                <span class="c">#f.flush() commented by recommendation from J.F.Sebastian</span>
    <span class="k">return</span> <span class="n">local_filename</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="s">'https://rinocloud.com/api/1/files/download/?id=&lt;object-id&gt;'</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span></code></pre></figure>

<h3 id="delete-file">Delete File</h3>
<p>To finalize, if you would like to delete an object:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s">'id'</span><span class="p">:</span> <span class="p">[</span><span class="s">'&lt;object-id1&gt;'</span><span class="p">,</span> <span class="s">'&lt;object-id2&gt;'</span><span class="p">]}</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'https://rinocloud.com/api/1/files/delete/'</span><span class="p">,</span>
                 <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
<span class="k">print</span> <span class="n">r</span><span class="o">.</span><span class="n">status</span>  <span class="c"># should be 204 no content</span></code></pre></figure>

<h3 id="summary">Summary</h3>

<p>Thats is, thats how you get data in and out of Rinocloud. If you have any questions, shoot us up on <a href="https://twitter.com/rinocloud">Twitter</a>.</p>

</article>


<aside class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/jekyll/update/2016/01/26/what-our-market-is-telling-us.html">
            What our market is telling us 
            <small><time datetime="2016-01-26T17:34:57+00:00">26 Jan 2016</time></small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/jekyll/update/2016/01/25/the-start-of-rinocloud.html">
            The start of RinoCloud 
            <small><time datetime="2016-01-25T17:34:57+00:00">25 Jan 2016</time></small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2016/01/18/why-i-started-rinocloud.html">
            Why I left my PhD at Cambridge to start Rinocloud
            <small><time datetime="2016-01-18T07:34:57+00:00">18 Jan 2016</time></small>
          </a>
        </h3>
      </li>
    
  </ul>
</aside>


      </main>

      <footer class="footer">
        <small>
          &copy; <time datetime="2016-01-28T16:54:36+00:00">2016</time>. All rights reserved.
        </small>
      </footer>
    </div>

  </body>
</html>
